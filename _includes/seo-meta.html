{% comment %}
Comprehensive SEO meta tags for blog posts and pages
Usage: {% include seo-meta.html page=page %}
{% endcomment %}

{% assign page_data = include.page %}
{% assign is_post = page_data.layout == 'post' %}
{% assign is_blog = page_data.layout == 'blog' or page_data.url contains '/blog' %}

{% comment %} Title optimization {% endcomment %}
{% if page_data.seo_title %}
  {% assign seo_title = page_data.seo_title %}
{% elsif page_data.title %}
  {% if is_post %}
    {% assign seo_title = page_data.title | append: ' | ' | append: site.title %}
  {% else %}
    {% assign seo_title = page_data.title | append: ' | ' | append: site.title %}
  {% endif %}
{% else %}
  {% assign seo_title = site.title %}
{% endif %}

{% comment %} Description optimization {% endcomment %}
{% if page_data.seo_description %}
  {% assign seo_description = page_data.seo_description %}
{% elsif page_data.excerpt %}
  {% assign seo_description = page_data.excerpt | strip_html | strip_newlines | truncate: 160 %}
{% elsif page_data.description %}
  {% assign seo_description = page_data.description %}
{% else %}
  {% assign seo_description = site.description %}
{% endif %}

{% comment %} Keywords optimization {% endcomment %}
{% assign seo_keywords = '' %}
{% if page_data.tags %}
  {% assign seo_keywords = page_data.tags | join: ', ' %}
  {% if page_data.categories %}
    {% assign seo_keywords = seo_keywords | append: ', ' | append: page_data.categories | join: ', ' %}
  {% endif %}
{% elsif page_data.categories %}
  {% assign seo_keywords = page_data.categories | join: ', ' %}
{% endif %}

{% comment %} Image optimization {% endcomment %}
{% if page_data.image %}
  {% assign seo_image = page_data.image | absolute_url %}
  {% assign seo_image_alt = page_data.image_alt | default: page_data.title %}
{% else %}
  {% assign seo_image = '/assets/images/og-image.jpg' | absolute_url %}
  {% assign seo_image_alt = site.title %}
{% endif %}

{% comment %} URL optimization {% endcomment %}
{% assign canonical_url = page_data.canonical_url | default: page_data.url | absolute_url %}

<!-- SEO Meta Tags -->
<title>{{ seo_title }}</title>
<meta name="description" content="{{ seo_description }}">
{% if seo_keywords != '' %}<meta name="keywords" content="{{ seo_keywords }}">{% endif %}
<meta name="author" content="{{ page_data.author | default: site.author }}">
<meta name="robots" content="{% if page_data.draft %}noindex, nofollow{% else %}index, follow{% endif %}">
<link rel="canonical" href="{{ canonical_url }}">

<!-- Open Graph Meta Tags -->
<meta property="og:type" content="{% if is_post %}article{% else %}website{% endif %}">
<meta property="og:title" content="{{ page_data.title | default: seo_title }}">
<meta property="og:description" content="{{ seo_description }}">
<meta property="og:url" content="{{ canonical_url }}">
<meta property="og:image" content="{{ seo_image }}">
<meta property="og:image:alt" content="{{ seo_image_alt }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="{{ site.title }}">
<meta property="og:locale" content="en_US">

{% if is_post %}
<!-- Article-specific Open Graph -->
<meta property="article:author" content="{{ page_data.author | default: site.author }}">
<meta property="article:published_time" content="{{ page_data.date | date_to_xmlschema }}">
<meta property="article:modified_time" content="{{ page_data.last_modified_at | default: page_data.date | date_to_xmlschema }}">
{% if page_data.categories %}{% for category in page_data.categories %}<meta property="article:section" content="{{ category }}">{% endfor %}{% endif %}
{% if page_data.tags %}{% for tag in page_data.tags %}<meta property="article:tag" content="{{ tag }}">{% endfor %}{% endif %}
{% if page_data.reading_time %}<meta property="article:reading_time" content="{{ page_data.reading_time }}">{% endif %}
{% endif %}

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@{{ site.twitter_username }}">
<meta name="twitter:creator" content="@{{ site.twitter_username }}">
<meta name="twitter:title" content="{{ page_data.title | default: seo_title }}">
<meta name="twitter:description" content="{{ seo_description }}">
<meta name="twitter:image" content="{{ seo_image }}">
<meta name="twitter:image:alt" content="{{ seo_image_alt }}">

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#667eea">
<meta name="msapplication-TileColor" content="#667eea">
{% if is_post %}<meta name="article:publisher" content="{{ site.url }}">{% endif %}
{% if page_data.last_modified_at %}<meta name="revised" content="{{ page_data.last_modified_at | date_to_xmlschema }}">{% endif %}

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  {% if is_post %}
  "@type": "BlogPosting",
  "headline": "{{ page_data.title }}",
  "description": "{{ seo_description }}",
  "image": {
    "@type": "ImageObject",
    "url": "{{ seo_image }}",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "{{ page_data.author | default: site.author }}",
    "url": "{{ site.url }}",
    "sameAs": [
      "https://linkedin.com/in/{{ site.linkedin_username }}",
      "https://github.com/{{ site.github_username }}",
      "https://twitter.com/{{ site.twitter_username }}"
    ]
  },
  "publisher": {
    "@type": "Person",
    "name": "{{ site.author }}",
    "url": "{{ site.url }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ '/assets/images/logo.png' | absolute_url }}",
      "width": 200,
      "height": 200
    }
  },
  "datePublished": "{{ page_data.date | date_to_xmlschema }}",
  "dateModified": "{{ page_data.last_modified_at | default: page_data.date | date_to_xmlschema }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ canonical_url }}"
  },
  {% if page_data.tags %}"keywords": "{{ page_data.tags | join: ', ' }}",{% endif %}
  {% if page_data.categories %}"articleSection": "{{ page_data.categories | first }}",{% endif %}
  {% if page_data.reading_time %}"timeRequired": "PT{{ page_data.reading_time }}M",{% endif %}
  "wordCount": "{{ page_data.content | number_of_words }}",
  "url": "{{ canonical_url }}",
  "isPartOf": {
    "@type": "Blog",
    "name": "{{ site.blog.title | default: 'Blog' }}",
    "url": "{{ '/blog/' | absolute_url }}"
  }
  {% elsif is_blog %}
  "@type": "Blog",
  "name": "{{ page_data.title | default: site.blog.title }}",
  "description": "{{ seo_description }}",
  "url": "{{ canonical_url }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.author }}",
    "url": "{{ site.url }}"
  },
  "publisher": {
    "@type": "Person",
    "name": "{{ site.author }}",
    "url": "{{ site.url }}"
  },
  "blogPost": [
    {% for post in site.posts limit: 10 %}
    {
      "@type": "BlogPosting",
      "headline": "{{ post.title }}",
      "url": "{{ post.url | absolute_url }}",
      "datePublished": "{{ post.date | date_to_xmlschema }}",
      "author": {
        "@type": "Person",
        "name": "{{ post.author | default: site.author }}"
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
  {% else %}
  "@type": "WebPage",
  "name": "{{ page_data.title | default: site.title }}",
  "description": "{{ seo_description }}",
  "url": "{{ canonical_url }}",
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ site.title }}",
    "url": "{{ site.url }}"
  },
  "author": {
    "@type": "Person",
    "name": "{{ site.author }}",
    "url": "{{ site.url }}"
  }
  {% endif %}
}
</script>

{% if is_post %}
<!-- Additional Structured Data for Blog Post -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ site.url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "{{ '/blog/' | absolute_url }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page_data.title }}",
      "item": "{{ canonical_url }}"
    }
  ]
}
</script>
{% endif %}

<!-- Feed Discovery -->
<link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS Feed" href="{{ '/feed.xml' | absolute_url }}">
<link rel="alternate" type="application/json" title="{{ site.title }} JSON Feed" href="{{ '/feed.json' | absolute_url }}">

<!-- Preconnect to external domains for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- DNS Prefetch for social sharing -->
<link rel="dns-prefetch" href="//twitter.com">
<link rel="dns-prefetch" href="//linkedin.com">
<link rel="dns-prefetch" href="//facebook.com">

{% comment %} Hreflang for international SEO (if needed) {% endcomment %}
{% if page_data.lang %}
<link rel="alternate" hreflang="{{ page_data.lang }}" href="{{ canonical_url }}">
{% endif %}
<link rel="alternate" hreflang="en" href="{{ canonical_url }}">

{% comment %} Pagination meta tags {% endcomment %}
{% if paginator %}
  {% if paginator.previous_page %}
    <link rel="prev" href="{{ paginator.previous_page_path | absolute_url }}">
  {% endif %}
  {% if paginator.next_page %}
    <link rel="next" href="{{ paginator.next_page_path | absolute_url }}">
  {% endif %}
{% endif %}